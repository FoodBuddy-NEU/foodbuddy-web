# User Profile Feature Documentation

## Overview
The User Profile feature allows users to manage their personal information and food preferences in FoodBuddy. This includes dietary restrictions, allergies, favorite cuisines, current cravings, and more.

## Features Implemented

### 1. Required Fields
- **userId**: Unique identifier (UUID) generated by Firestore
- **username**: Display name for the user
- **email**: Login account (cannot be changed after signup)
- **avatarUrl**: Profile picture URL (Cloudinary upload support)
- **createdAt/updatedAt**: Automatically tracked timestamps

### 2. Food Preferences
- **Cravings**: Current food desires (e.g., Ramen, Bubble Tea, Pizza)
- **Favorite Cuisines**: Preferred food types (e.g., Chinese, Japanese, Italian)
- **Favorite Restaurants**: Bookmarked restaurant IDs
- **Dietary Restrictions**: Food limitations (e.g., Vegetarian, Vegan, Halal)
- **Allergies**: Allergen information (e.g., Peanuts, Shellfish, Dairy)

### 3. Selection System
Users can:
- Select from predefined common options
- Add custom entries for any preference field
- Toggle selections on/off
- Remove custom entries

## Files Created

### Type Definitions
- **src/types/userProfile.ts**
  - `UserProfile` interface
  - `UserProfileUpdate` type
  - Common option constants (COMMON_CRAVINGS, COMMON_CUISINES, etc.)

### Backend Functions
- **src/lib/userProfile.ts**
  - `getUserProfile(userId)`: Fetch user profile
  - `createUserProfile(userId, email, username, avatarUrl?)`: Create new profile
  - `updateUserProfile(userId, updates)`: Update profile fields
  - `addToUserArray(userId, field, value)`: Add item to array field
  - `removeFromUserArray(userId, field, value)`: Remove item from array field

### Components
- **src/components/UserProfileForm.tsx**
  - Interactive form for editing profile
  - Multi-select buttons for common options
  - Custom input fields for personalized entries
  - Save functionality with success/error messages

### Pages
- **src/app/profile/page.tsx**
  - Profile page route
  - Authentication check (redirects to /login if not logged in)
  - Profile loading and error handling

### API Routes
- **src/app/api/profile/route.ts**
  - GET `/api/profile?userId=xxx`: Fetch user profile
  - PUT `/api/profile`: Update user profile

### Updated Files
- **src/app/signup/signupPage.tsx**
  - Added username field
  - Automatic profile creation on signup
  - Redirects to /profile after signup for preference setup

- **src/components/Header.tsx**
  - Added Profile link to navigation

## Database Structure (Firestore)

### Collection: `users`
```javascript
{
  userId: "auto-generated-uuid",
  username: "string",
  email: "string",
  avatarUrl: "string | null",
  createdAt: Timestamp,
  updatedAt: Timestamp,
  cravings: ["string"],
  favoriteCuisines: ["string"],
  favoriteRestaurants: ["string"], // restaurant IDs
  dietaryRestrictions: ["string"],
  allergies: ["string"]
}
```

## Common Options Provided

### Cravings (15 options)
Ramen, Bubble Tea, Pizza, Sushi, Burgers, Tacos, Pasta, Fried Chicken, BBQ, Salad, Sandwich, Noodles, Curry, Dumplings, Seafood

### Cuisines (15 options)
Chinese, Japanese, Korean, Thai, Vietnamese, Italian, Mexican, American, French, Indian, Mediterranean, Middle Eastern, Spanish, Greek, Brazilian

### Dietary Restrictions (11 options)
Vegetarian, Vegan, Halal, Kosher, Gluten-Free, Dairy-Free, Nut-Free, Low-Carb, Keto, Paleo, Pescatarian

### Allergies (10 options)
Peanuts, Tree Nuts, Shellfish, Fish, Eggs, Milk, Soy, Wheat, Sesame, Gluten

## Usage Flow

1. **New User Signup**
   - User enters username, email, password
   - Profile automatically created with default empty arrays
   - Redirected to /profile page to set preferences

2. **Profile Management**
   - Navigate to /profile from header
   - Select from common options (colored buttons)
   - Add custom entries using text input
   - Click "Save Profile" to persist changes

3. **Future Integration**
   - Profile data can be used to:
     - Filter restaurant recommendations
     - Highlight allergen warnings
     - Personalize search results
     - Match users with similar preferences

## Testing

### Test Files Created
- **src/__tests__/userProfile.test.ts**: Backend function tests
- **src/__tests__/UserProfileForm.test.tsx**: Component tests

### Test Coverage
- 22 tests passing
- Coverage includes:
  - Profile CRUD operations
  - Array field management
  - Form interactions
  - Custom entry addition/removal
  - Error handling

## Next Steps

### Recommended Enhancements
1. **Avatar Upload**: Integrate Cloudinary upload widget
2. **Restaurant Filtering**: Use profile data to filter search results
3. **Allergen Warnings**: Display warnings on restaurant pages
4. **Profile Completion**: Show progress indicator for incomplete profiles
5. **Privacy Settings**: Allow users to control profile visibility
6. **Social Features**: Share preferences with group members

### Performance Considerations
- Profile data is loaded once on page mount
- Updates use optimistic UI (immediate visual feedback)
- Firestore serverTimestamp ensures accurate tracking

## Security Notes
- Profile updates require user authentication
- userId is immutable after creation
- Email cannot be changed (Firebase Auth restriction)
- All Firestore operations use security rules (configure in Firebase Console)

## Styling
- Responsive design with Tailwind CSS
- Dark mode support
- Color-coded preference categories:
  - Cravings: Blue
  - Cuisines: Green
  - Dietary Restrictions: Orange
  - Allergies: Red
